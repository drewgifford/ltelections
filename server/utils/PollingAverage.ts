import Poll from "../polling/Poll";
import Race, { OfficeType } from "../types/Race";
import { ReportingCandidate } from "../types/ReportingUnit";

const PRESIDENT_RESULTS: any = {"AL":{"2012":{"GOP":0.6055,"Dem":0.3836},"2016":{"GOP":0.6208,"Dem":0.3436},"2020":{"Dem":0.3657,"GOP":0.6203}},"AK":{"2012":{"GOP":0.548,"Dem":0.4081},"2016":{"GOP":0.5128,"Dem":0.3655},"2020":{"Dem":0.4277,"GOP":0.5283}},"AZ":{"2012":{"GOP":0.5365,"Dem":0.4459},"2016":{"GOP":0.4867,"Dem":0.4513},"2020":{"Dem":0.4936,"GOP":0.4906}},"AR":{"2012":{"GOP":0.6057,"Dem":0.3688},"2016":{"GOP":0.6057,"Dem":0.3365},"2020":{"Dem":0.3478,"GOP":0.624}},"CA":{"2012":{"Dem":0.6024,"GOP":0.3712},"2016":{"Dem":0.6173,"GOP":0.3162},"2020":{"Dem":0.6348,"GOP":0.3432}},"CO":{"2012":{"Dem":0.5149,"GOP":0.4613},"2016":{"Dem":0.4816,"GOP":0.4325},"2020":{"Dem":0.5501,"GOP":0.416}},"CT":{"2012":{"Dem":0.5809,"GOP":0.4075},"2016":{"Dem":0.5457,"GOP":0.4093},"2020":{"Dem":0.5926,"GOP":0.3919}},"DE":{"2012":{"Dem":0.5861,"GOP":0.3998},"2016":{"Dem":0.5335,"GOP":0.4192},"2020":{"Dem":0.5874,"GOP":0.3977}},"DC":{"2012":{"Dem":0.9091,"GOP":0.0728},"2016":{"Dem":0.9048,"GOP":0.0407},"2020":{"Dem":0.9215,"GOP":0.054}},"FL":{"2012":{"Dem":0.5001,"GOP":0.4913},"2016":{"GOP":0.4902,"Dem":0.4782},"2020":{"Dem":0.4786,"GOP":0.5122}},"GA":{"2012":{"GOP":0.5333,"Dem":0.4551},"2016":{"GOP":0.5077,"Dem":0.4564},"2020":{"Dem":0.4947,"GOP":0.4924}},"HI":{"2012":{"Dem":0.7015,"GOP":0.2768},"2016":{"Dem":0.6098,"GOP":0.2944},"2020":{"Dem":0.6315,"GOP":0.3395}},"ID":{"2012":{"GOP":0.6453,"Dem":0.3262},"2016":{"GOP":0.5926,"Dem":0.2749},"2020":{"Dem":0.3307,"GOP":0.6384}},"IL":{"2012":{"Dem":0.576,"GOP":0.4073},"2016":{"Dem":0.5583,"GOP":0.3876},"2020":{"Dem":0.5754,"GOP":0.4055}},"IN":{"2012":{"GOP":0.5413,"Dem":0.4393},"2016":{"GOP":0.5694,"Dem":0.3777},"2020":{"Dem":0.4096,"GOP":0.5702}},"IA":{"2012":{"Dem":0.5199,"GOP":0.4618},"2016":{"GOP":0.5116,"Dem":0.4175},"2020":{"GOP":0.528,"Dem":0.4465}},"KS":{"2012":{"GOP":0.5971,"Dem":0.3799},"2016":{"GOP":0.5665,"Dem":0.3605},"2020":{"GOP":0.5621,"Dem":0.4156}},"KY":{"2012":{"GOP":0.6049,"Dem":0.378},"2016":{"GOP":0.6252,"Dem":0.3268},"2020":{"GOP":0.6209,"Dem":0.3615}},"LA":{"2012":{"GOP":0.5778,"Dem":0.4058},"2016":{"GOP":0.5809,"Dem":0.3845},"2020":{"Dem":0.3985,"GOP":0.5846}},"ME":{"2012":{"Dem":0.5537,"GOP":0.4033},"2016":{"Dem":0.4635,"GOP":0.4348},"2020":{"Dem":0.5253,"GOP":0.4355}},"ME-1":{"2012":{"Dem":0.6088,"GOP":0.3912},"2016":{"Dem":0.5378,"GOP":0.3935},"2020":{"Dem":0.5999,"GOP":0.3718}},"ME-2":{"2012":{"Dem":0.547,"GOP":0.453},"2016":{"Dem":0.4161,"GOP":0.5064},"2020":{"Dem":0.4549,"GOP":0.516}},"MD":{"2012":{"Dem":0.6197,"GOP":0.359},"2016":{"Dem":0,"GOP":0.0001},"2020":{"GOP":0.3215,"Dem":0.6536}},"MA":{"2012":{"Dem":0.6034,"GOP":0.3732},"2016":{"Dem":0.5905,"GOP":0.3229},"2020":{"Dem":0.6512,"GOP":0.3191}},"MI":{"2012":{"Dem":0.5421,"GOP":0.4471},"2016":{"GOP":0.475,"Dem":0.4727},"2020":{"Dem":0.5062,"GOP":0.4784}},"MN":{"2012":{"Dem":0.5265,"GOP":0.4496},"2016":{"Dem":0.4645,"GOP":0.4493},"2020":{"GOP":0.4528,"Dem":0.524}},"MS":{"2012":{"GOP":0.5529,"Dem":0.4379},"2016":{"GOP":0.5794,"Dem":0.4011},"2020":{"Dem":0.4106,"GOP":0.576}},"MO":{"2012":{"GOP":0.5376,"Dem":0.4438},"2016":{"GOP":0.5677,"Dem":0.3814},"2020":{"GOP":0.568,"Dem":0.4141}},"MT":{"2012":{"GOP":0.5535,"Dem":0.417},"2016":{"GOP":0.5647,"Dem":0.3594},"2020":{"GOP":0.5692,"Dem":0.4055}},"NE":{"2012":{"GOP":0.598,"Dem":0.3803},"2016":{"GOP":0.5875,"Dem":0.337},"2020":{"GOP":0.5822,"Dem":0.3917}},"NE-1":{"2012":{"GOP":0.5806,"Dem":0.4194},"2016":{"GOP":0.5594,"Dem":0.3762},"2020":{"GOP":0.5434,"Dem":0.4328}},"NE-2":{"2012":{"GOP":0.5321,"Dem":0.4679},"2016":{"GOP":0.4813,"Dem":0.4618},"2020":{"GOP":0.4584,"Dem":0.5216}},"NE-3":{"2012":{"GOP":0.7153,"Dem":0.2847},"2016":{"GOP":0.7422,"Dem":0.2058},"2020":{"GOP":0.7491,"Dem":0.2308}},"NV":{"2012":{"Dem":0.5236,"GOP":0.4568},"2016":{"Dem":0.4792,"GOP":0.455},"2020":{"GOP":0.4767,"Dem":0.5006}},"NH":{"2012":{"Dem":0.5198,"GOP":0.464},"2016":{"Dem":0.4683,"GOP":0.4646},"2020":{"GOP":0.4536,"Dem":0.5271}},"NJ":{"2012":{"Dem":0.5834,"GOP":0.4062},"2016":{"Dem":0.5545,"GOP":0.4135},"2020":{"GOP":0.414,"Dem":0.5733}},"NM":{"2012":{"Dem":0.5299,"GOP":0.4284},"2016":{"Dem":0.4826,"GOP":0.4004},"2020":{"Dem":0.5429,"GOP":0.435}},"NY":{"2012":{"Dem":0.6076,"GOP":0.3124},"2016":{"Dem":0.5614,"GOP":0.3239},"2020":{"Dem":0.6039,"GOP":0.3746}},"NC":{"2012":{"GOP":0.5039,"Dem":0.4835},"2016":{"GOP":0.4983,"Dem":0.4617},"2020":{"GOP":0.4993,"Dem":0.4859}},"ND":{"2012":{"GOP":0.5832,"Dem":0.387},"2016":{"GOP":0.6296,"Dem":0.2723},"2020":{"GOP":0.6511,"Dem":0.3176}},"OH":{"2012":{"Dem":0.5067,"GOP":0.4769},"2016":{"GOP":0.5169,"Dem":0.4356},"2020":{"GOP":0.5327,"Dem":0.4524}},"OK":{"2012":{"GOP":0.6677,"Dem":0.3323},"2016":{"GOP":0.6532,"Dem":0.2893},"2020":{"GOP":0.6537,"Dem":0.3229}},"OR":{"2012":{"Dem":0.5424,"GOP":0.4215},"2016":{"Dem":0.5007,"GOP":0.3909},"2020":{"GOP":0.4037,"Dem":0.5645}},"PA":{"2012":{"Dem":0.5208,"GOP":0.4668},"2016":{"GOP":0.4858,"Dem":0.4785},"2020":{"GOP":0.4884,"Dem":0.5001}},"RI":{"2012":{"Dem":0.627,"GOP":0.3524},"2016":{"Dem":0.5441,"GOP":0.389},"2020":{"Dem":0.5948,"GOP":0.3867}},"SC":{"2012":{"GOP":0.5456,"Dem":0.4409},"2016":{"GOP":0.5494,"Dem":0.4067},"2020":{"GOP":0.5509,"Dem":0.4342}},"SD":{"2012":{"GOP":0.5789,"Dem":0.3987},"2016":{"GOP":0.6153,"Dem":0.3174},"2020":{"GOP":0.6177,"Dem":0.3561}},"TN":{"2012":{"GOP":0.5948,"Dem":0.3908},"2016":{"GOP":0.6072,"Dem":0.3472},"2020":{"GOP":0.6066,"Dem":0.3745}},"TX":{"2012":{"GOP":0.5717,"Dem":0.4138},"2016":{"GOP":0.5223,"Dem":0.4324},"2020":{"GOP":0.5206,"Dem":0.4648}},"UT":{"2012":{"GOP":0.7279,"Dem":0.2475},"2016":{"GOP":0.4554,"Dem":0.2746},"2020":{"Dem":0.3765,"GOP":0.5813}},"VT":{"2012":{"Dem":0.6657,"GOP":0.3097},"2016":{"Dem":0.5572,"GOP":0.2976},"2020":{"Dem":0.6546,"GOP":0.3038}},"VA":{"2012":{"Dem":0.5116,"GOP":0.4728},"2016":{"Dem":0.4975,"GOP":0.4443},"2020":{"Dem":0.5411,"GOP":0.44}},"WA":{"2012":{"Dem":0.5616,"GOP":0.4129},"2016":{"Dem":0.5254,"GOP":0.3683},"2020":{"Dem":0.5797,"GOP":0.3877}},"WV":{"2012":{"GOP":0.623,"Dem":0.3554},"2016":{"GOP":0.6863,"Dem":0.2648},"2020":{"Dem":0.297,"GOP":0.6863}},"WI":{"2012":{"Dem":0.5278,"GOP":0.4594},"2016":{"GOP":0.4722,"Dem":0.4645},"2020":{"Dem":0.4945,"GOP":0.4882}},"WY":{"2012":{"GOP":0.6819,"Dem":0.2764},"2016":{"GOP":0.674,"Dem":0.2163},"2020":{"Dem":0.2639,"GOP":0.695}}}
const SENATE_RESULTS: any = {"AZ": {"2012": {"GOP": 0.4923, "Dem": 0.462}, "2016": {"Dem": 0.4075, "GOP": 0.5371}, "2018": {"GOP": 0.4761, "Dem": 0.4996}, "2020": {"GOP": 0.4881, "Dem": 0.5116}}, "CA": {"2012": {"Dem": 0.6252, "GOP": 0.3748}, "2016": {"Dem": 0.616}, "2018": {"Dem": 0.4584}}, "CT": {"2012": {"Dem": 0.5245, "GOP": 0.3999}, "2016": {"Dem": 0.5768, "GOP": 0.3462}, "2018": {"Dem": 0.568, "GOP": 0.3935}}, "DE": {"2012": {"Dem": 0.6642, "GOP": 0.2895}, "2014": {"GOP": 0.4223, "Dem": 0.5583}, "2018": {"Dem": 0.5995, "GOP": 0.3782}, "2020": {"Dem": 0.5944, "GOP": 0.379}}, "FL": {"2012": {"Dem": 0.5523, "GOP": 0.4223}, "2016": {"Dem": 0.4431, "GOP": 0.5198}, "2018": {"GOP": 0.5005, "Dem": 0.4993}}, "HI": {"2012": {"GOP": 0.3683, "Dem": 0.6165}, "2014": {"GOP": 0.2651, "Dem": 0.6676}, "2016": {"Dem": 0.7005, "GOP": 0.2117}, "2018": {"Dem": 0.7115, "GOP": 0.2885}}, "IN": {"2012": {"GOP": 0.4428, "Dem": 0.5004}, "2016": {"Dem": 0.4241, "GOP": 0.5211}, "2018": {"GOP": 0.5073, "Dem": 0.4484}}, "ME": {"2012": {"OTHER": 0.5113, "Dem": 0.1282}, "2014": {"GOP": 0.6702, "Dem": 0.3084}, "2018": {"GOP": 0.3523, "Dem": 0.1045}, "2020": {"GOP": 0.5042, "Dem": 0.4192}}, "MD": {"2012": {"Dem": 0.5598, "GOP": 0.2633, "OTHER": 0.1637}, "2016": {"Dem": 0.6089, "GOP": 0.3567}, "2018": {"GOP": 0.3031, "Dem": 0.6486}}, "MA": {"2012": {"GOP": 0.4579, "Dem": 0.5327}, "2014": {"GOP": 0.3622, "Dem": 0.5899}, "2018": {"Dem": 0.6034, "GOP": 0.3617}, "2020": {"Dem": 0.6446, "GOP": 0.322}}, "MI": {"2012": {"Dem": 0.588, "GOP": 0.3798}, "2014": {"GOP": 0.4133, "Dem": 0.5461}, "2018": {"GOP": 0.4576, "Dem": 0.5226}, "2020": {"Dem": 0.499, "GOP": 0.4822}}, "MN": {"2012": {"GOP": 0.3053, "Dem": 0.6523}, "2014": {"GOP": 0.4291, "Dem": 0.5315}, "2018": {"GOP": 0.4235, "Dem": 0.5297}, "2020": {"GOP": 0.435, "Dem": 0.4874}}, "MS": {"2012": {"GOP": 0.5716}, "2014": {"Dem": 0.3789, "GOP": 0.599}, "2018": {"Dem": 0.4637, "GOP": 0.5363}, "2020": {"Dem": 0.4413, "GOP": 0.5411}}, "MO": {"2012": {"GOP": 0.3911, "Dem": 0.5481}, "2016": {"GOP": 0.4918, "Dem": 0.4639}, "2018": {"GOP": 0.5138, "Dem": 0.4557}}, "MT": {"2012": {"Dem": 0.4858, "GOP": 0.4486}, "2014": {"GOP": 0.5779, "Dem": 0.4007}, "2018": {"Dem": 0.5033, "GOP": 0.4678}, "2020": {"Dem": 0.4499, "GOP": 0.5501}}, "NE": {"2012": {"Dem": 0.4223, "GOP": 0.5777}, "2014": {"Dem": 0.3149, "GOP": 0.6434}, "2018": {"GOP": 0.5769, "Dem": 0.3862}, "2020": {"GOP": 0.6274, "Dem": 0.2443}}, "NV": {"2012": {"GOP": 0.4587, "Dem": 0.4471}, "2016": {"GOP": 0.4467, "Dem": 0.471}, "2018": {"Dem": 0.5041, "GOP": 0.4538}}, "NJ": {"2012": {"Dem": 0.5887, "GOP": 0.3937}, "2014": {"Dem": 0.5584, "GOP": 0.4233}, "2018": {"Dem": 0.5401, "GOP": 0.4283}, "2020": {"Dem": 0.5723, "GOP": 0.4092}}, "NM": {"2012": {"Dem": 0.5101, "GOP": 0.4528}, "2014": {"GOP": 0.4444, "Dem": 0.5556}, "2018": {"Dem": 0.5409, "LIBERTARIAN": 0.1538, "GOP": 0.3053}, "2020": {"GOP": 0.4562, "Dem": 0.5173}}, "NY": {"2012": {"GOP": 0.2128, "Dem": 0.6211}, "2016": {"GOP": 0.221, "Dem": 0.6133}, "2018": {"Dem": 0.6202, "GOP": 0.2858}}, "ND": {"2012": {"GOP": 0.4932, "Dem": 0.5024}, "2016": {"GOP": 0.7848, "Dem": 0.1697}, "2018": {"GOP": 0.5511, "Dem": 0.4427}}, "OH": {"2012": {"GOP": 0.447, "Dem": 0.507}, "2016": {"Dem": 0.3716, "GOP": 0.5803}, "2018": {"Dem": 0.5341, "GOP": 0.4657}}, "PA": {"2012": {"GOP": 0.4459}, "2016": {"Dem": 0.4734, "GOP": 0.4877}, "2018": {"Dem": 0.5561, "GOP": 0.4274}}, "RI": {"2012": {"Dem": 0.6481, "GOP": 0.3497}, "2014": {"Dem": 0.7058, "GOP": 0.2925}, "2018": {"Dem": 0.6144}, "2020": {"Dem": 0.6648, "GOP": 0.3335}}, "TN": {"2012": {"GOP": 0.6489, "Dem": 0.3041}, "2014": {"Dem": 0.3187, "GOP": 0.6187}, "2018": {"GOP": 0.5471, "Dem": 0.4392}, "2020": {"GOP": 0.622, "Dem": 0.3516}}, "TX": {"2012": {"GOP": 0.5646, "Dem": 0.4062}, "2014": {"GOP": 0.6156, "Dem": 0.3436}, "2018": {"GOP": 0.5089, "Dem": 0.4833}, "2020": {"GOP": 0.5351, "Dem": 0.4387}}, "UT": {"2012": {"GOP": 0.6531, "Dem": 0.2998}, "2016": {"GOP": 0.6815, "Dem": 0.2706}, "2018": {"GOP": 0.6259, "Dem": 0.3091}}, "VT": {"2012": {"GOP": 0.249, "OTHER": 0.71}, "2016": {"GOP": 0.3234, "Dem": 0.5999}, "2018": {"OTHER": 0.6732, "GOP": 0.2739}}, "VA": {"2012": {"GOP": 0.4696, "Dem": 0.5287}, "2014": {"GOP": 0.4834, "Dem": 0.4915}, "2018": {"GOP": 0.4101, "Dem": 0.57}, "2020": {"Dem": 0.5599, "GOP": 0.4391}}, "WA": {"2012": {"Dem": 0.6045, "GOP": 0.3955}, "2016": {"GOP": 0.4099, "Dem": 0.5901}, "2018": {"Dem": 0.5843, "GOP": 0.4157}}, "WV": {"2012": {"Dem": 0.6057, "GOP": 0.3647}, "2014": {"Dem": 0.3446, "GOP": 0.6212}, "2018": {"Dem": 0.4955, "GOP": 0.463}, "2020": {"GOP": 0.7028, "Dem": 0.27}}, "WI": {"2012": {"Dem": 0.5141, "GOP": 0.4586}, "2016": {"Dem": 0.4681, "GOP": 0.5017}, "2018": {"Dem": 0.5542, "GOP": 0.4458}}, "WY": {"2012": {"GOP": 0.7389, "Dem": 0.2115}, "2014": {"GOP": 0.7102, "Dem": 0.1716}, "2018": {"GOP": 0.6696, "Dem": 0.301}, "2020": {"OTHER": 0.2613}}, "AL": {"2014": {"GOP": 0.9725}, "2016": {"Dem": 0.3587, "GOP": 0.6396}, "2020": {"Dem": 0.3974, "GOP": 0.601}}, "AK": {"2014": {"Dem": 0.4583, "GOP": 0.4796}, "2016": {"LIBERTARIAN": 0.2916, "Dem": 0.1162, "OTHER": 0.1323, "GOP": 0.4436}, "2020": {"Dem": 0.4119, "GOP": 0.539}}, "AR": {"2014": {"GOP": 0.565, "Dem": 0.3943}, "2016": {"GOP": 0.5977, "Dem": 0.3617}, "2020": {"LIBERTARIAN": 0.3347, "GOP": 0.6653}}, "CO": {"2014": {"GOP": 0.482, "Dem": 0.4626}, "2016": {"Dem": 0.4997, "GOP": 0.4431}, "2020": {"Dem": 0.535, "GOP": 0.4418}}, "GA": {"2014": {"GOP": 0.5289, "Dem": 0.4521}, "2016": {"Dem": 0.4103, "GOP": 0.5478}, "2020": {"GOP": 0.2591, "Dem": 0.329}, "2021": {"GOP": 0.4938, "Dem": 0.5062}}, "ID": {"2014": {"Dem": 0.3467, "GOP": 0.6533}, "2016": {"GOP": 0.6613, "Dem": 0.2773}, "2020": {"Dem": 0.3325, "GOP": 0.6262}}, "IL": {"2014": {"Dem": 0.5355, "GOP": 0.4269}, "2016": {"GOP": 0.3978, "Dem": 0.5486}, "2020": {"Dem": 0.5493, "GOP": 0.3887}}, "IA": {"2014": {"GOP": 0.521, "Dem": 0.4376}, "2016": {"GOP": 0.6009, "Dem": 0.3566}, "2020": {"GOP": 0.5088, "Dem": 0.444}}, "KS": {"2014": {"OTHER": 0.4253, "GOP": 0.5315}, "2016": {"Dem": 0.3224, "GOP": 0.6218}, "2020": {"GOP": 0.5322, "Dem": 0.4179}}, "KY": {"2014": {"Dem": 0.4072, "GOP": 0.5619}, "2016": {"GOP": 0.5727, "Dem": 0.4272}, "2020": {"GOP": 0.5776, "Dem": 0.3823}}, "LA": {"2014": {"GOP": 0.486, "Dem": 0.4431}, "2016": {"GOP": 0.2685, "Dem": 0.1742}, "2020": {"GOP": 0.5932, "Dem": 0.1902}}, "NH": {"2014": {"Dem": 0.5146, "GOP": 0.4821}, "2016": {"GOP": 0.4784, "Dem": 0.4798}, "2020": {"GOP": 0.4099, "Dem": 0.5664}}, "NC": {"2014": {"Dem": 0.4726, "GOP": 0.4882}, "2016": {"Dem": 0.4537, "GOP": 0.5106}, "2020": {"GOP": 0.4869, "Dem": 0.4694}}, "OK": {"2014": {"Dem": 0.2855, "GOP": 0.6785}, "2016": {"Dem": 0.2458, "GOP": 0.6774}, "2020": {"GOP": 0.6291, "Dem": 0.3275}}, "OR": {"2014": {"Dem": 0.5573, "GOP": 0.3687}, "2016": {"Dem": 0.566, "GOP": 0.3335}, "2020": {"GOP": 0.3932, "Dem": 0.5691}}, "SC": {"2014": {"Dem": 0.3709, "GOP": 0.6112}, "2016": {"Dem": 0.3437, "GOP": 0.6057}, "2020": {"GOP": 0.5444, "Dem": 0.4417}}, "SD": {"2014": {"GOP": 0.5037, "OTHER": 0.1709, "Dem": 0.2951}, "2016": {"GOP": 0.7183, "Dem": 0.2817}, "2020": {"GOP": 0.6574, "Dem": 0.3426}}}
const HOUSE_PVI: any = {"AL-01":24.47,"AL-02":-3.58,"AL-03":27.36,"AL-04":35.24,"AL-05":20.67,"AL-06":25.39,"AL-07":-15.11,"AK-01":8.02,"AZ-01":2.01,"AZ-02":6.35,"AZ-03":-24.02,"AZ-04":-2.27,"AZ-05":11.11,"AZ-06":2.66,"AZ-07":-14.98,"AZ-08":9.69,"AZ-09":15.64,"AR-01":22.37,"AR-02":9.03,"AR-03":14.91,"AR-04":19.55,"CA-01":12.21,"CA-02":-23.19,"CA-03":3.72,"CA-04":-16.71,"CA-05":8.73,"CA-06":-7.39,"CA-07":-17.4,"CA-08":-26.09,"CA-09":-4.58,"CA-10":-17.91,"CA-11":-36.7,"CA-12":-39.7,"CA-13":-3.85,"CA-14":-21.7,"CA-15":-27.74,"CA-16":-25.63,"CA-17":-23.31,"CA-18":-21.38,"CA-19":-18.46,"CA-20":15.59,"CA-21":-8.7,"CA-22":-5.07,"CA-23":7.69,"CA-24":-12.57,"CA-25":-6.18,"CA-26":-7.96,"CA-27":-4.05,"CA-28":-15.55,"CA-29":-25.79,"CA-30":-22.67,"CA-31":-14.83,"CA-32":-19.53,"CA-33":-11.71,"CA-34":-32.46,"CA-35":-13.32,"CA-36":-20.81,"CA-37":-36.63,"CA-38":-14.33,"CA-39":-11.86,"CA-40":1.86,"CA-41":3.17,"CA-42":-22.37,"CA-43":-31.98,"CA-44":-24.0,"CA-45":-2.14,"CA-46":-14.93,"CA-47":-3.28,"CA-48":9.33,"CA-49":-3.14,"CA-50":-14.38,"CA-51":-11.56,"CA-52":-18.28,"CO-01":-28.92,"CO-02":-17.5,"CO-03":7.06,"CO-04":12.85,"CO-05":8.94,"CO-06":-9.01,"CO-07":-3.89,"CO-08":0.45,"CT-01":-11.75,"CT-02":-2.86,"CT-03":-7.32,"CT-04":-13.07,"CT-05":-2.66,"DE-01":-6.74,"FL-01":19.31,"FL-02":7.7,"FL-03":9.24,"FL-04":5.88,"FL-05":10.86,"FL-06":13.98,"FL-07":5.1,"FL-08":11.37,"FL-09":-8.05,"FL-10":-14.3,"FL-11":8.04,"FL-12":16.58,"FL-13":5.58,"FL-14":-8.13,"FL-15":3.67,"FL-16":6.99,"FL-17":10.15,"FL-18":13.39,"FL-19":12.91,"FL-20":-25.1,"FL-21":6.86,"FL-22":-7.26,"FL-23":-4.81,"FL-24":-24.64,"FL-25":-9.2,"FL-26":8.41,"FL-27":-0.15,"FL-28":2.37,"GA-01":9.19,"GA-02":-3.11,"GA-03":17.99,"GA-04":-26.63,"GA-05":-31.65,"GA-06":11.08,"GA-07":-9.64,"GA-08":16.38,"GA-09":22.26,"GA-10":14.6,"GA-11":11.03,"GA-12":7.52,"GA-13":-27.87,"GA-14":21.77,"HI-01":-13.6,"HI-02":-13.7,"ID-01":22.18,"ID-02":14.5,"IL-01":-20.38,"IL-02":-18.75,"IL-03":-19.8,"IL-04":-22.46,"IL-05":-18.34,"IL-06":-3.27,"IL-07":-35.72,"IL-08":-6.0,"IL-09":-19.44,"IL-10":-10.98,"IL-11":-5.3,"IL-12":23.97,"IL-13":-3.44,"IL-14":-3.56,"IL-15":21.95,"IL-16":13.46,"IL-17":-1.91,"IN-01":-2.77,"IN-02":13.95,"IN-03":17.97,"IN-04":17.72,"IN-05":11.21,"IN-06":19.18,"IN-07":-18.95,"IN-08":19.03,"IN-09":16.18,"IA-01":3.49,"IA-02":4.28,"IA-03":2.52,"IA-04":15.52,"KS-01":17.87,"KS-02":10.78,"KS-03":1.0,"KS-04":13.99,"KY-01":24.02,"KY-02":21.15,"KY-03":-8.6,"KY-04":19.33,"KY-05":32.24,"KY-06":8.52,"LA-01":24.76,"LA-02":-24.91,"LA-03":25.25,"LA-04":18.15,"LA-05":16.55,"LA-06":-6.65,"ME-01":-8.76,"ME-02":5.57,"MD-01":10.6,"MD-02":-7.47,"MD-03":-9.62,"MD-04":-39.51,"MD-05":-15.08,"MD-06":-1.97,"MD-07":-30.11,"MD-08":-29.49,"MA-01":-8.68,"MA-02":-13.08,"MA-03":-11.41,"MA-04":-11.94,"MA-05":-23.35,"MA-06":-11.01,"MA-07":-35.0,"MA-08":-15.25,"MA-09":-6.29,"MI-01":12.59,"MI-02":16.48,"MI-03":-1.28,"MI-04":4.74,"MI-05":14.56,"MI-06":-10.89,"MI-07":2.12,"MI-08":1.07,"MI-09":17.54,"MI-10":3.05,"MI-11":-7.38,"MI-12":-22.54,"MI-13":-23.47,"MN-01":7.41,"MN-02":-0.61,"MN-03":-7.54,"MN-04":-16.61,"MN-05":-29.73,"MN-06":11.99,"MN-07":19.26,"MN-08":8.04,"MS-01":18.35,"MS-02":-11.19,"MS-03":14.74,"MS-04":21.74,"MO-01":-27.32,"MO-02":7.1,"MO-03":16.03,"MO-04":22.62,"MO-05":-10.78,"MO-06":21.19,"MO-07":23.76,"MO-08":28.11,"MT-01":6.23,"MT-02":16.3,"NE-01":8.67,"NE-02":-0.17,"NE-03":28.89,"NV-01":-2.61,"NV-02":8.05,"NV-03":-1.46,"NV-04":-2.59,"NH-01":-0.06,"NH-02":-1.71,"NJ-01":-10.32,"NJ-02":4.81,"NJ-03":-4.61,"NJ-04":14.13,"NJ-05":-3.72,"NJ-06":-7.95,"NJ-07":1.33,"NJ-08":-21.95,"NJ-09":-8.31,"NJ-10":-30.01,"NJ-11":-5.8,"NJ-12":-12.09,"NM-01":-4.7,"NM-02":-1.12,"NM-03":-3.59,"NY-01":4.55,"NY-02":7.7,"NY-03":-2.2,"NY-04":-6.0,"NY-05":-32.42,"NY-06":-14.73,"NY-07":-31.1,"NY-08":-26.83,"NY-09":-25.11,"NY-10":-36.69,"NY-11":6.89,"NY-12":-34.23,"NY-13":-38.29,"NY-14":-27.94,"NY-15":-34.85,"NY-16":-20.14,"NY-17":-2.88,"NY-18":-1.61,"NY-19":0.5,"NY-20":-7.94,"NY-21":10.82,"NY-22":-3.15,"NY-23":12.75,"NY-24":12.45,"NY-25":-8.39,"NY-26":-11.02,"NC-01":-3.14,"NC-02":-21.55,"NC-03":16.55,"NC-04":-26.02,"NC-05":13.13,"NC-06":11.27,"NC-07":9.65,"NC-08":17.2,"NC-09":10.68,"NC-10":16.31,"NC-11":8.95,"NC-12":-29.44,"NC-13":11.45,"NC-14":13.78,"ND-01":19.85,"OH-01":-1.75,"OH-02":24.87,"OH-03":-19.71,"OH-04":20.49,"OH-05":15.48,"OH-06":16.11,"OH-07":6.98,"OH-08":13.74,"OH-09":3.22,"OH-10":4.12,"OH-11":-27.63,"OH-12":17.58,"OH-13":0.64,"OH-14":9.45,"OH-15":5.92,"OK-01":13.88,"OK-02":28.89,"OK-03":24.38,"OK-04":18.55,"OK-05":12.4,"OR-01":-17.74,"OR-02":15.21,"OR-03":-22.18,"OR-04":-4.05,"OR-05":-1.82,"OR-06":-4.06,"PA-01":0.13,"PA-02":-20.46,"PA-03":-38.99,"PA-04":-7.01,"PA-05":-13.97,"PA-06":-4.76,"PA-07":2.12,"PA-08":4.12,"PA-09":21.03,"PA-10":4.85,"PA-11":13.42,"PA-12":-7.85,"PA-13":25.12,"PA-14":18.07,"PA-15":20.79,"PA-16":12.71,"PA-17":-0.37,"RI-01":-12.39,"RI-02":-4.24,"SC-01":7.24,"SC-02":8.27,"SC-03":21.15,"SC-04":12.22,"SC-05":11.53,"SC-06":-14.33,"SC-07":11.48,"SD-01":16.05,"TN-01":30.06,"TN-02":17.82,"TN-03":18.8,"TN-04":21.77,"TN-05":8.56,"TN-06":17.3,"TN-07":10.05,"TN-08":21.23,"TN-09":-22.39,"TX-01":25.53,"TX-02":14.84,"TX-03":10.92,"TX-04":16.39,"TX-05":14.24,"TX-06":15.12,"TX-07":-13.29,"TX-08":16.44,"TX-09":-25.68,"TX-10":12.59,"TX-11":22.83,"TX-12":12.26,"TX-13":26.05,"TX-14":16.52,"TX-15":1.36,"TX-16":-17.06,"TX-17":14.32,"TX-18":-23.16,"TX-19":25.92,"TX-20":-14.88,"TX-21":13.16,"TX-22":11.05,"TX-23":5.27,"TX-24":9.81,"TX-25":18.66,"TX-26":13.04,"TX-27":13.32,"TX-28":-3.2,"TX-29":-18.44,"TX-30":-26.8,"TX-31":13.72,"TX-32":-14.05,"TX-33":-23.68,"TX-34":-8.6,"TX-35":-20.97,"TX-36":18.29,"TX-37":-24.29,"TX-38":12.38,"UT-01":12.3,"UT-02":11.24,"UT-03":13.08,"UT-04":15.94,"VT-01":-15.54,"VA-01":6.34,"VA-02":2.05,"VA-03":-17.04,"VA-04":-15.75,"VA-05":6.62,"VA-06":13.83,"VA-07":-0.88,"VA-08":-26.27,"VA-09":23.32,"VA-10":-5.92,"VA-11":-18.29,"WA-01":-13.31,"WA-02":-9.29,"WA-03":4.62,"WA-04":11.41,"WA-05":7.74,"WA-06":-6.31,"WA-07":-36.5,"WA-08":-1.05,"WA-09":-21.11,"WA-10":-6.66,"WV-01":23.23,"WV-02":21.52,"WI-01":3.1,"WI-02":-18.93,"WI-03":4.36,"WI-04":-24.76,"WI-05":14.29,"WI-06":10.24,"WI-07":12.27,"WI-08":10.16,"WY-01":25.27}


const RESULT_WEIGHTS: any = {
    "2012": 0.05,
    "2014": 0.1,
    "2016": 0.5,
    "2018": 0.75,
    "2020": 1,
    "2021": 1.5,
    "2022": 1.5,
    "0": 1,
}

export type PollingAverage = {
    [polID: string]: {
        average: number,
        includedPolls: number
    }
}

export async function getPollingAverage(race: Race, type: PollingAverageType, POLLS: { [key: string]: Poll[] }){

    const INCLUDED_POLLS = 18;

    let stateName = `${race.state?.name}`;
    if(race.officeID == OfficeType.President){
        if(race.seatNum) stateName = `${race.state?.name} CD-${race.seatNum}`;
    }
    else if (race.officeID == OfficeType.House){
        if(race.seatNum) stateName = `${race.state?.name}-${race.seatNum}`;
    }

    let includedPolls: Poll[] = [];


    

    if(Object.keys(POLLS).includes(stateName)){
        includedPolls = POLLS[stateName].filter(
            poll => {
                if(type == PollingAverageType.Senate) return true;
                
                if(!(poll.results.find(x => x.party == "DEM") && poll.results.find(x => x.party == "REP"))) return false;

                return true;
            }


        ).slice(0, INCLUDED_POLLS);
    }

    let candidateAverages: PollingAverage = {}
    let candidates = race.candidates;

    for(let i = 0; i < includedPolls.length; i++){

        // For each poll
        let poll = includedPolls[i];
        let results = poll.results;

        for(let result of results){

            let party = result.party;

            if(party == "DEM") party = "Dem";
            else if (party == "REP") party = "GOP"; 
            else if (party == "LIB") party = "Lib";
            else if (party == "GRE") party = "Grn";
            else if (party == "IDP") party = "Ind";
            else if (party == "IND") party = "Ind";

            let cand = candidates.find(x => x.party == party && x.last?.includes(result.answer));

            if(!cand) {
                cand = candidates.find(x => x.last == result.answer);

                if(!cand) continue;

            };
            let key = cand.polID || 'undefined';

            if(!Object.keys(candidateAverages).includes(key)) {
                candidateAverages[key] = {
                    includedPolls: 0,
                    average: 0
                }
            }

            candidateAverages[key].average += (Number(result.pct))/100;
            candidateAverages[key].includedPolls += 1;
        }
    }

    // Historical results

    let stateResults;
    if(race.officeID == OfficeType.House) {

        let districtName = `${race.state?.postalCode}-${(Number(race.seatNum) < 10 ? '0'+race.seatNum : race.seatNum)}`

        stateResults = {
            "0": {
                "GOP": 0.5 + (HOUSE_PVI[districtName]/200),
                "Dem": 0.5 - (HOUSE_PVI[districtName]/200)
            }
        }

    } else {
        if(race.officeID == OfficeType.President){
            if(race.seatNum) stateResults = PRESIDENT_RESULTS[`${race.state?.postalCode}-${race.seatNum}`];
            else stateResults = PRESIDENT_RESULTS[`${race.state?.postalCode}`];
        } else stateResults = SENATE_RESULTS[`${race.state?.postalCode}`]
    }
    let historicalAverages: any = {}

    
    for(let year of Object.keys(stateResults)){
        
        let results = stateResults[year];

        for(let party in results){

            let parsedParty = party;
            if(party == "OTHER") parsedParty = "Ind";
            else if(party == "LIBERTARIAN") parsedParty = "Lib";
            else if(party == "GREEN") parsedParty = "Grn";

            let cand = candidates.find(x => x.party == parsedParty);

            
            

            if(!cand) {
                continue;
            };
            let key = cand.polID || "undefined";

            if(!Object.keys(historicalAverages).includes(key)) {
                historicalAverages[key] = {
                    average: 0,
                    totalWeight: 0,
                };
            }

            let ratio = 1;

            // Divide this boost according to average among the candidates of the same party
        
            if(Object.keys(candidateAverages).includes(key)){

                let average = candidateAverages[key].average;

                // Get candidates of the same party in polling average
                let partyCandidates = race.candidates.filter(x => Object.keys(candidateAverages).includes(x.polID as string) && x.party == cand.party);

                let totalPartyAverage = partyCandidates.reduce((total: number, curr: ReportingCandidate) => {
                    return total + candidateAverages[curr.polID as string].average
                }, 0);

                ratio = average/totalPartyAverage;
            }

            let yearWeight = RESULT_WEIGHTS[year];
            historicalAverages[key].average += (results[party] * yearWeight * ratio);
            historicalAverages[key].totalWeight += (yearWeight);

        }
    
    }

    for(let candName of Object.keys(historicalAverages)){
        historicalAverages[candName].average /= historicalAverages[candName].totalWeight;
    }

    for(let candName of Object.keys(historicalAverages)){

        if(!Object.keys(candidateAverages).includes(candName)) {
            candidateAverages[candName] = {
                average: 0,
                includedPolls: 0
            }
        }
        let includedPolls = candidateAverages[candName].includedPolls;

        if(includedPolls < INCLUDED_POLLS){
            let addedPolls = INCLUDED_POLLS - includedPolls;
            candidateAverages[candName].average += addedPolls * historicalAverages[candName].average;
            candidateAverages[candName].includedPolls = INCLUDED_POLLS;
        }

    }

    for(let candName of Object.keys(candidateAverages)){
        candidateAverages[candName].average /= candidateAverages[candName].includedPolls;
    }

    

    

    return candidateAverages;

}